#!/bin/ksh93
. ${PROC_DIR:=${0%/*}}/CWPARAM
export UDB_DB=${WAREHOUSE_DB}
. ${PROC_DIR}/DB2COMMON

db2 -f ${UDB_CMD}

TABLE=TECW.EBM_EVENT_RULE
CURSOR_NAME=TSTG_${RUN_TYPE}_EBM_EVENT_RULE
QUERY="
SELECT
		RUN_ID
		, RPT_CASE_ID
		, EVENT
		, RPT_RULE_ID
		, CHAR('SYMMETRY')
		, MBR_MPI_ID
		, CAST(TASKNBR as CHAR(3))
		, RULE_TYPE_NBR
		, RESULT_FLG
		, CASE WHEN EBM_FLG = '0' AND COMPLIANCE_FLG = '0' THEN '0'
				ELSE '1'
		  END AS EBM_QUAL_IND
		, EBM_FLG
		, COMPLIANCE_FLG
		, CURRENT_TIMESTAMP
		, CURRENT_TIMESTAMP
		, '${SCHED_JOB_NAME}'
FROM TSTG.${RUN_TYPE}_SYMM_EBM_SUMMARY_RESULT_FL
"

db2 "declare ${CURSOR_NAME} cursor for ${QUERY}"
EXIT_CODE=$?

if [[ ${EXIT_CODE} -ne 0 ]]
then
	echo "Unable to declare cursor. RC:$EXIT_CODE}"
	exit ${EXIT_CODE}
fi

db2 "load from ${CURSOR_NAME} of cursor insert into ${TABLE} nonrecoverable"
EXIT_CODE=$?

exit $EXIT_CODE

