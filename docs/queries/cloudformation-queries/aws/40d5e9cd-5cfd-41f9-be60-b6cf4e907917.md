---
title: Redshift Cluster Without VPC
hide:
  toc: true
  navigation: true
---

<style>
  .highlight .hll {
    background-color: #ff171742;
  }
  .md-content {
    max-width: 1100px;
    margin: 0 auto;
  }
</style>

-   **Query id:** 40d5e9cd-5cfd-41f9-be60-b6cf4e907917
-   **Query name:** Redshift Cluster Without VPC
-   **Platform:** CloudFormation
-   **Severity:** <span style="color:#edd57e">Low</span>
-   **Category:** Insecure Configurations
-   **CWE:** <a href="https://cwe.mitre.org/data/definitions/284.html" onclick="newWindowOpenerSafe(event, 'https://cwe.mitre.org/data/definitions/284.html')">284</a>
-   **URL:** [Github](https://github.com/Checkmarx/kics/tree/master/assets/queries/cloudFormation/aws/redshift_cluster_without_vpc)

### Description
Redshift Cluster should be configured in VPC (Virtual Private Cloud)<br>
[Documentation](https://docs.aws.amazon.com/AWSCloudFormation/latest/TemplateReference/aws-resource-redshift-cluster.html#cfn-redshift-cluster-clustersubnetgroupname)

### Code samples
#### Code samples with security vulnerabilities
```yaml title="Positive test num. 1 - yaml file" hl_lines="5"
AWSTemplateFormatVersion: "2010-09-09"
Resources:
  RedshiftCluster:
    Type: AWS::Redshift::Cluster
    Properties:
      ClusterIdentifier: tf-redshift-cluster
      DBName: mydb

```
```json title="Positive test num. 2 - json file" hl_lines="6"
{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "RedshiftCluster": {
      "Type": "AWS::Redshift::Cluster",
      "Properties": {
        "ClusterIdentifier": "tf-redshift-cluster",
        "DBName": "mydb",
        "ClusterSubnetGroupName": { "Ref": "RedshiftSubnetGroup" },
        "VpcSecurityGroupIds": [
          { "Ref": "RedshiftSecurityGroup" }
        ]
      }
    }
  }
}

```
```json title="Positive test num. 3 - json file" hl_lines="26"
{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "RedshiftSubnetGroup": {
      "Type": "AWS::Redshift::ClusterSubnetGroup",
      "Properties": {
        "Description": "Subnet group for Redshift",
        "SubnetIds": [
          { "Ref": "Subnet1" },
          { "Ref": "Subnet2" }
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "RedshiftSubnetGroup"
          }
        ]
      }
    },
    "RedshiftCluster": {
      "Type": "AWS::Redshift::Cluster",
      "Properties": {
        "ClusterIdentifier": "tf-redshift-cluster",
        "DBName": "mydb",
        "ClusterSubnetGroupName": { "Ref": "RedshiftSubnetGroup" },
        "VpcSecurityGroupIds": [
          { "Ref": "RedshiftSecurityGroup" }
        ]
      }
    }
  }
}

```
<details><summary>Positive test num. 4 - json file</summary>

```json hl_lines="24"
{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "RedshiftSecurityGroup": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "Redshift access",
        "VpcId": { "Ref": "MyVPC" },
        "SecurityGroupIngress": [
          {
            "IpProtocol": "tcp",
            "FromPort": 5439,
            "ToPort": 5439,
            "CidrIp": "0.0.0.0/0"
          }
        ]
      }
    },
    "RedshiftCluster": {
      "Type": "AWS::Redshift::Cluster",
      "Properties": {
        "ClusterIdentifier": "tf-redshift-cluster",
        "DBName": "mydb",
        "ClusterSubnetGroupName": { "Ref": "RedshiftSubnetGroup" },
        "VpcSecurityGroupIds": [
          { "Ref": "RedshiftSecurityGroup" }
        ]
      }
    }
  }
}

```
</details>
<details><summary>Positive test num. 5 - yaml file</summary>

```yaml hl_lines="5"
AWSTemplateFormatVersion: "2010-09-09"
Resources:
  RedshiftCluster:
    Type: AWS::Redshift::Cluster
    Properties:
      ClusterIdentifier: tf-redshift-cluster
      DBName: mydb
      ClusterSubnetGroupName: !Ref RedshiftSubnetGroup

  
```
</details>
<details><summary>Positive test num. 6 - yaml file</summary>

```yaml hl_lines="5"
AWSTemplateFormatVersion: "2010-09-09"
Resources:
  RedshiftCluster:
    Type: AWS::Redshift::Cluster
    Properties:
      ClusterIdentifier: tf-redshift-cluster
      DBName: mydb
      VpcSecurityGroupIds:
        - !Ref RedshiftSecurityGroup

  
```
</details>
<details><summary>Positive test num. 7 - yaml file</summary>

```yaml hl_lines="5"
AWSTemplateFormatVersion: "2010-09-09"
Resources:
  RedshiftCluster:
    Type: AWS::Redshift::Cluster
    Properties:
      ClusterIdentifier: tf-redshift-cluster
      DBName: mydb
      ClusterSubnetGroupName: !Ref RedshiftSubnetGroup
      VpcSecurityGroupIds:
        - !Ref RedshiftSecurityGroup

  
```
</details>
<details><summary>Positive test num. 8 - yaml file</summary>

```yaml hl_lines="19"
AWSTemplateFormatVersion: "2010-09-09"
Resources:
  RedshiftSubnetGroup:
    Type: AWS::Redshift::ClusterSubnetGroup
    Properties:
      Description: Subnet group for Redshift
      SubnetIds:
        - !Ref Subnet1
        - !Ref Subnet2
      Tags:
        - Key: Name
          Value: RedshiftSubnetGroup
  RedshiftCluster:
    Type: AWS::Redshift::Cluster
    Properties:
      ClusterIdentifier: tf-redshift-cluster
      DBName: mydb
      ClusterSubnetGroupName: !Ref RedshiftSubnetGroup
      VpcSecurityGroupIds:
        - !Ref RedshiftSecurityGroup
```
</details>
<details><summary>Positive test num. 9 - yaml file</summary>

```yaml hl_lines="18"
AWSTemplateFormatVersion: "2010-09-09"
Resources:
  RedshiftSecurityGroup:
      Type: AWS::EC2::SecurityGroup
      Properties:
        GroupDescription: Redshift access
        VpcId: !Ref MyVPC
        SecurityGroupIngress:
          - IpProtocol: tcp
            FromPort: 5439
            ToPort: 5439
            CidrIp: 0.0.0.0/0 
  RedshiftCluster:
    Type: AWS::Redshift::Cluster
    Properties:
      ClusterIdentifier: tf-redshift-cluster
      DBName: mydb
      ClusterSubnetGroupName: !Ref RedshiftSubnetGroup
      VpcSecurityGroupIds:
        - !Ref RedshiftSecurityGroup
```
</details>
<details><summary>Positive test num. 10 - json file</summary>

```json hl_lines="6"
{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "RedshiftCluster": {
      "Type": "AWS::Redshift::Cluster",
      "Properties": {
        "ClusterIdentifier": "tf-redshift-cluster",
        "DBName": "mydb"
      }
    }
  }
}

```
</details>
<details><summary>Positive test num. 11 - json file</summary>

```json hl_lines="6"
{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "RedshiftCluster": {
      "Type": "AWS::Redshift::Cluster",
      "Properties": {
        "ClusterIdentifier": "tf-redshift-cluster",
        "DBName": "mydb",
        "ClusterSubnetGroupName": { "Ref": "RedshiftSubnetGroup" }
      }
    }
  }
}

```
</details>
<details><summary>Positive test num. 12 - json file</summary>

```json hl_lines="6"
{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "RedshiftCluster": {
      "Type": "AWS::Redshift::Cluster",
      "Properties": {
        "ClusterIdentifier": "tf-redshift-cluster",
        "DBName": "mydb",
        "VpcSecurityGroupIds": [
          { "Ref": "RedshiftSecurityGroup" }
        ]
      }
    }
  }
}

```
</details>


#### Code samples without security vulnerabilities
```yaml title="Negative test num. 1 - yaml file"
Resources:
  RedshiftSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Redshift access
      VpcId: !Ref MyVPC
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 5439
          ToPort: 5439
          CidrIp: 0.0.0.0/0  

  RedshiftSubnetGroup:
    Type: AWS::Redshift::ClusterSubnetGroup
    Properties:
      Description: Subnet group for Redshift
      SubnetIds:
        - !Ref Subnet1
        - !Ref Subnet2
      Tags:
        - Key: Name
          Value: RedshiftSubnetGroup

  RedshiftCluster:
    Type: AWS::Redshift::Cluster
    Properties:
      ClusterIdentifier: tf-redshift-cluster
      DBName: mydb
      ClusterSubnetGroupName: !Ref RedshiftSubnetGroup
      VpcSecurityGroupIds:
        - !Ref RedshiftSecurityGroup

  
```
```json title="Negative test num. 2 - json file"
{
  "Resources": {
    "RedshiftSecurityGroup": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "Redshift access",
        "VpcId": { "Ref": "MyVPC" },
        "SecurityGroupIngress": [
          {
            "IpProtocol": "tcp",
            "FromPort": 5439,
            "ToPort": 5439,
            "CidrIp": "0.0.0.0/0"
          }
        ]
      }
    },
    "RedshiftSubnetGroup": {
      "Type": "AWS::Redshift::ClusterSubnetGroup",
      "Properties": {
        "Description": "Subnet group for Redshift",
        "SubnetIds": [
          { "Ref": "Subnet1" },
          { "Ref": "Subnet2" }
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "RedshiftSubnetGroup"
          }
        ]
      }
    },
    "RedshiftCluster": {
      "Type": "AWS::Redshift::Cluster",
      "Properties": {
        "ClusterIdentifier": "tf-redshift-cluster",
        "DBName": "mydb",
        "ClusterSubnetGroupName": { "Ref": "RedshiftSubnetGroup" },
        "VpcSecurityGroupIds": [
          { "Ref": "RedshiftSecurityGroup" }
        ]
      }
    }
  }
}

```
