---
title: Elasticsearch Domain Not Encrypted Node To Node
hide:
  toc: true
  navigation: true
---

<style>
  .highlight .hll {
    background-color: #ff171742;
  }
  .md-content {
    max-width: 1100px;
    margin: 0 auto;
  }
</style>

-   **Query id:** 43ed6fe0-edb6-43c2-97be-6501cf563d53
-   **Query name:** Elasticsearch Domain Not Encrypted Node To Node
-   **Platform:** CloudFormation
-   **Severity:** <span style="color:#ff7213">Medium</span>
-   **Category:** Encryption
-   **CWE:** <a href="https://cwe.mitre.org/data/definitions/311.html" onclick="newWindowOpenerSafe(event, 'https://cwe.mitre.org/data/definitions/311.html')">311</a>
-   **URL:** [Github](https://github.com/Checkmarx/kics/tree/master/assets/queries/cloudFormation/aws/elasticsearch_domain_not_encrypted_node_to_node)

### Description
Elasticsearch Domain encryption should be enabled node to node<br>
[Documentation](https://docs.aws.amazon.com/AWSCloudFormation/latest/TemplateReference/aws-properties-elasticsearch-domain-nodetonodeencryptionoptions.html)

### Code samples
#### Code samples with security vulnerabilities
```yaml title="Positive test num. 1 - yaml file" hl_lines="7"
AWSTemplateFormatVersion: '2010-09-09'
Description: Example

Resources:
  MyOpenSearchDomain:
    Type: AWS::OpenSearchService::Domain
    Properties:
      DomainName: my-sample-domain
      EngineVersion: Elasticsearch_7.10
      ClusterConfig:
        InstanceType: r6g.large.search
        InstanceCount: 2
        DedicatedMasterEnabled: true
        DedicatedMasterType: r6g.large.search
        DedicatedMasterCount: 3
        ZoneAwarenessEnabled: true
        ZoneAwarenessConfig:
          AvailabilityZoneCount: 2
      EBSOptions:
        EBSEnabled: true
        VolumeType: gp3
        VolumeSize: 50
        Iops: 3000
        Throughput: 125
      AccessPolicies:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              AWS: "*"
            Action: "es:*"
            Resource: !Sub "arn:aws:es:${AWS::Region}:${AWS::AccountId}:domain/my-sample-domain/*"
      EncryptionAtRestOptions:
        Enabled: true
      DomainEndpointOptions:
        EnforceHTTPS: true
        TLSSecurityPolicy: Policy-Min-TLS-1-2-2019-07
      SnapshotOptions:
        AutomatedSnapshotStartHour: 3
      AdvancedOptions:
        rest.action.multi.allow_explicit_index: "true"
        override_main_response_version: "true"
      Tags:
        - Key: Environment
          Value: Production
        - Key: Project
          Value: OpenSearch

```
```json title="Positive test num. 2 - json file" hl_lines="10"
{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Example",
    "Resources": {
        "MyOpenSearchDomain": {
            "Type": "AWS::OpenSearchService::Domain",
            "Properties": {
                "DomainName": "my-sample-domain",
                "EngineVersion": "Elasticsearch_7.10",
                "NodeToNodeEncryptionOptions": {},
                "EncryptionAtRestOptions": {
                    "Enabled": false
                },
                "DomainEndpointOptions": {
                    "EnforceHTTPS": true,
                    "TLSSecurityPolicy": "Policy-Min-TLS-1-2-2019-07"
                },
                "SnapshotOptions": {
                    "AutomatedSnapshotStartHour": 3
                },
                "AdvancedOptions": {
                    "rest.action.multi.allow_explicit_index": "true",
                    "override_main_response_version": "true"
                },
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": "Production"
                    },
                    {
                        "Key": "Project",
                        "Value": "OpenSearch"
                    }
                ]
            }
        }
    }
}
```
```yaml title="Positive test num. 3 - yaml file" hl_lines="7"
AWSTemplateFormatVersion: '2010-09-09'
Description: Example

Resources:
  MyElasticsearchDomain:
    Type: AWS::Elasticsearch::Domain
    Properties:
      DomainName: my-es-domain
      ElasticsearchVersion: 7.10
      NodeToNodeEncryptionOptions:
      EncryptionAtRestOptions:
        Enabled: true
      DomainEndpointOptions:
        EnforceHTTPS: true
        TLSSecurityPolicy: Policy-Min-TLS-1-2-2019-07
      SnapshotOptions:
        AutomatedSnapshotStartHour: 2
      AdvancedOptions:
        rest.action.multi.allow_explicit_index: "true"
        override_main_response_version: "true"
      Tags:
        - Key: Environment
          Value: Production
        - Key: Department
          Value: Analytics

```
<details><summary>Positive test num. 4 - json file</summary>

```json hl_lines="10"
{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Example",
    "Resources": {
        "MyElasticsearchDomain": {
            "Type": "AWS::Elasticsearch::Domain",
            "Properties": {
                "DomainName": "my-es-domain",
                "ElasticsearchVersion": 7.1,
                "NodeToNodeEncryptionOptions": {},
                "EncryptionAtRestOptions": {
                    "Enabled": true
                },
                "DomainEndpointOptions": {
                    "EnforceHTTPS": true,
                    "TLSSecurityPolicy": "Policy-Min-TLS-1-2-2019-07"
                },
                "SnapshotOptions": {
                    "AutomatedSnapshotStartHour": 2
                },
                "AdvancedOptions": {
                    "rest.action.multi.allow_explicit_index": "true",
                    "override_main_response_version": "true"
                },
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": "Production"
                    },
                    {
                        "Key": "Department",
                        "Value": "Analytics"
                    }
                ]
            }
        }
    }
}
```
</details>
<details><summary>Positive test num. 5 - json file</summary>

```json hl_lines="7"
{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Example",
    "Resources": {
        "MyOpenSearchDomain": {
            "Type": "AWS::OpenSearchService::Domain",
            "Properties": {
                "DomainName": "my-sample-domain",
                "EngineVersion": "Elasticsearch_7.10",
                "ClusterConfig": {
                    "InstanceType": "r6g.large.search",
                    "InstanceCount": 2,
                    "DedicatedMasterEnabled": true,
                    "DedicatedMasterType": "r6g.large.search",
                    "DedicatedMasterCount": 3,
                    "ZoneAwarenessEnabled": true,
                    "ZoneAwarenessConfig": {
                        "AvailabilityZoneCount": 2
                    }
                },
                "EBSOptions": {
                    "EBSEnabled": true,
                    "VolumeType": "gp3",
                    "VolumeSize": 50,
                    "Iops": 3000,
                    "Throughput": 125
                },
                "AccessPolicies": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "AWS": "*"
                            },
                            "Action": "es:*",
                            "Resource": {
                                "Fn::Sub": "arn:aws:es:${AWS::Region}:${AWS::AccountId}:domain/my-sample-domain/*"
                            }
                        }
                    ]
                },
                "EncryptionAtRestOptions": {
                    "Enabled": true
                },
                "DomainEndpointOptions": {
                    "EnforceHTTPS": true,
                    "TLSSecurityPolicy": "Policy-Min-TLS-1-2-2019-07"
                },
                "SnapshotOptions": {
                    "AutomatedSnapshotStartHour": 3
                },
                "AdvancedOptions": {
                    "rest.action.multi.allow_explicit_index": "true",
                    "override_main_response_version": "true"
                },
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": "Production"
                    },
                    {
                        "Key": "Project",
                        "Value": "OpenSearch"
                    }
                ]
            }
        }
    }
}
```
</details>
<details><summary>Positive test num. 6 - yaml file</summary>

```yaml hl_lines="34"
AWSTemplateFormatVersion: '2010-09-09'
Description: Example

Resources:
  MyOpenSearchDomain:
    Type: AWS::OpenSearchService::Domain
    Properties:
      DomainName: my-sample-domain
      EngineVersion: Elasticsearch_7.10
      ClusterConfig:
        InstanceType: r6g.large.search
        InstanceCount: 2
        DedicatedMasterEnabled: true
        DedicatedMasterType: r6g.large.search
        DedicatedMasterCount: 3
        ZoneAwarenessEnabled: true
        ZoneAwarenessConfig:
          AvailabilityZoneCount: 2
      EBSOptions:
        EBSEnabled: true
        VolumeType: gp3
        VolumeSize: 50
        Iops: 3000
        Throughput: 125
      AccessPolicies:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              AWS: "*"
            Action: "es:*"
            Resource: !Sub "arn:aws:es:${AWS::Region}:${AWS::AccountId}:domain/my-sample-domain/*"
      NodeToNodeEncryptionOptions:
        Enabled: false
      EncryptionAtRestOptions:
        Enabled: false
      DomainEndpointOptions:
        EnforceHTTPS: true
        TLSSecurityPolicy: Policy-Min-TLS-1-2-2019-07
      SnapshotOptions:
        AutomatedSnapshotStartHour: 3
      AdvancedOptions:
        rest.action.multi.allow_explicit_index: "true"
        override_main_response_version: "true"
      Tags:
        - Key: Environment
          Value: Production
        - Key: Project
          Value: OpenSearch

```
</details>
<details><summary>Positive test num. 7 - json file</summary>

```json hl_lines="44"
{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Example",
    "Resources": {
        "MyOpenSearchDomain": {
            "Type": "AWS::OpenSearchService::Domain",
            "Properties": {
                "DomainName": "my-sample-domain",
                "EngineVersion": "Elasticsearch_7.10",
                "ClusterConfig": {
                    "InstanceType": "r6g.large.search",
                    "InstanceCount": 2,
                    "DedicatedMasterEnabled": true,
                    "DedicatedMasterType": "r6g.large.search",
                    "DedicatedMasterCount": 3,
                    "ZoneAwarenessEnabled": true,
                    "ZoneAwarenessConfig": {
                        "AvailabilityZoneCount": 2
                    }
                },
                "EBSOptions": {
                    "EBSEnabled": true,
                    "VolumeType": "gp3",
                    "VolumeSize": 50,
                    "Iops": 3000,
                    "Throughput": 125
                },
                "AccessPolicies": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "AWS": "*"
                            },
                            "Action": "es:*",
                            "Resource": {
                                "Fn::Sub": "arn:aws:es:${AWS::Region}:${AWS::AccountId}:domain/my-sample-domain/*"
                            }
                        }
                    ]
                },
                "NodeToNodeEncryptionOptions": {
                    "Enabled": false
                },
                "EncryptionAtRestOptions": {
                    "Enabled": false
                },
                "DomainEndpointOptions": {
                    "EnforceHTTPS": true,
                    "TLSSecurityPolicy": "Policy-Min-TLS-1-2-2019-07"
                },
                "SnapshotOptions": {
                    "AutomatedSnapshotStartHour": 3
                },
                "AdvancedOptions": {
                    "rest.action.multi.allow_explicit_index": "true",
                    "override_main_response_version": "true"
                },
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": "Production"
                    },
                    {
                        "Key": "Project",
                        "Value": "OpenSearch"
                    }
                ]
            }
        }
    }
}
```
</details>
<details><summary>Positive test num. 8 - yaml file</summary>

```yaml hl_lines="7"
AWSTemplateFormatVersion: '2010-09-09'
Description: Example

Resources:
  MyElasticsearchDomain:
    Type: AWS::Elasticsearch::Domain
    Properties:
      DomainName: my-es-domain
      ElasticsearchVersion: 7.10
      ElasticsearchClusterConfig:
        InstanceType: r5.large.elasticsearch
        InstanceCount: 2
        DedicatedMasterEnabled: true
        DedicatedMasterType: r5.large.elasticsearch
        DedicatedMasterCount: 3
        ZoneAwarenessEnabled: true
        ZoneAwarenessConfig:
          AvailabilityZoneCount: 2
      EBSOptions:
        EBSEnabled: true
        VolumeType: gp2
        VolumeSize: 50
      AccessPolicies:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              AWS: "*"
            Action: "es:*"
            Resource: !Sub "arn:aws:es:${AWS::Region}:${AWS::AccountId}:domain/my-es-domain/*"
      EncryptionAtRestOptions:
        Enabled: true
      DomainEndpointOptions:
        EnforceHTTPS: true
        TLSSecurityPolicy: Policy-Min-TLS-1-2-2019-07
      SnapshotOptions:
        AutomatedSnapshotStartHour: 2
      AdvancedOptions:
        rest.action.multi.allow_explicit_index: "true"
        override_main_response_version: "true"
      Tags:
        - Key: Environment
          Value: Production
        - Key: Department
          Value: Analytics

```
</details>
<details><summary>Positive test num. 9 - json file</summary>

```json hl_lines="7"
{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Example",
    "Resources": {
        "MyElasticsearchDomain": {
            "Type": "AWS::Elasticsearch::Domain",
            "Properties": {
                "DomainName": "my-es-domain",
                "ElasticsearchVersion": 7.1,
                "ElasticsearchClusterConfig": {
                    "InstanceType": "r5.large.elasticsearch",
                    "InstanceCount": 2,
                    "DedicatedMasterEnabled": true,
                    "DedicatedMasterType": "r5.large.elasticsearch",
                    "DedicatedMasterCount": 3,
                    "ZoneAwarenessEnabled": true,
                    "ZoneAwarenessConfig": {
                        "AvailabilityZoneCount": 2
                    }
                },
                "EBSOptions": {
                    "EBSEnabled": true,
                    "VolumeType": "gp2",
                    "VolumeSize": 50
                },
                "AccessPolicies": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "AWS": "*"
                            },
                            "Action": "es:*",
                            "Resource": {
                                "Fn::Sub": "arn:aws:es:${AWS::Region}:${AWS::AccountId}:domain/my-es-domain/*"
                            }
                        }
                    ]
                },
                "EncryptionAtRestOptions": {
                    "Enabled": true
                },
                "DomainEndpointOptions": {
                    "EnforceHTTPS": true,
                    "TLSSecurityPolicy": "Policy-Min-TLS-1-2-2019-07"
                },
                "SnapshotOptions": {
                    "AutomatedSnapshotStartHour": 2
                },
                "AdvancedOptions": {
                    "rest.action.multi.allow_explicit_index": "true",
                    "override_main_response_version": "true"
                },
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": "Production"
                    },
                    {
                        "Key": "Department",
                        "Value": "Analytics"
                    }
                ]
            }
        }
    }
}
```
</details>
<details><summary>Positive test num. 10 - yaml file</summary>

```yaml hl_lines="32"
AWSTemplateFormatVersion: '2010-09-09'
Description: Example

Resources:
  MyElasticsearchDomain:
    Type: AWS::Elasticsearch::Domain
    Properties:
      DomainName: my-es-domain
      ElasticsearchVersion: 7.10
      ElasticsearchClusterConfig:
        InstanceType: r5.large.elasticsearch
        InstanceCount: 2
        DedicatedMasterEnabled: true
        DedicatedMasterType: r5.large.elasticsearch
        DedicatedMasterCount: 3
        ZoneAwarenessEnabled: true
        ZoneAwarenessConfig:
          AvailabilityZoneCount: 2
      EBSOptions:
        EBSEnabled: true
        VolumeType: gp2
        VolumeSize: 50
      AccessPolicies:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              AWS: "*"
            Action: "es:*"
            Resource: !Sub "arn:aws:es:${AWS::Region}:${AWS::AccountId}:domain/my-es-domain/*"
      NodeToNodeEncryptionOptions:
        Enabled: false
      EncryptionAtRestOptions:
        Enabled: true
      DomainEndpointOptions:
        EnforceHTTPS: true
        TLSSecurityPolicy: Policy-Min-TLS-1-2-2019-07
      SnapshotOptions:
        AutomatedSnapshotStartHour: 2
      AdvancedOptions:
        rest.action.multi.allow_explicit_index: "true"
        override_main_response_version: "true"
      Tags:
        - Key: Environment
          Value: Production
        - Key: Department
          Value: Analytics

```
</details>
<details><summary>Positive test num. 11 - json file</summary>

```json hl_lines="42"
{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Example",
    "Resources": {
        "MyElasticsearchDomain": {
            "Type": "AWS::Elasticsearch::Domain",
            "Properties": {
                "DomainName": "my-es-domain",
                "ElasticsearchVersion": 7.1,
                "ElasticsearchClusterConfig": {
                    "InstanceType": "r5.large.elasticsearch",
                    "InstanceCount": 2,
                    "DedicatedMasterEnabled": true,
                    "DedicatedMasterType": "r5.large.elasticsearch",
                    "DedicatedMasterCount": 3,
                    "ZoneAwarenessEnabled": true,
                    "ZoneAwarenessConfig": {
                        "AvailabilityZoneCount": 2
                    }
                },
                "EBSOptions": {
                    "EBSEnabled": true,
                    "VolumeType": "gp2",
                    "VolumeSize": 50
                },
                "AccessPolicies": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "AWS": "*"
                            },
                            "Action": "es:*",
                            "Resource": {
                                "Fn::Sub": "arn:aws:es:${AWS::Region}:${AWS::AccountId}:domain/my-es-domain/*"
                            }
                        }
                    ]
                },
                "NodeToNodeEncryptionOptions": {
                    "Enabled": false
                },
                "EncryptionAtRestOptions": {
                    "Enabled": true
                },
                "DomainEndpointOptions": {
                    "EnforceHTTPS": true,
                    "TLSSecurityPolicy": "Policy-Min-TLS-1-2-2019-07"
                },
                "SnapshotOptions": {
                    "AutomatedSnapshotStartHour": 2
                },
                "AdvancedOptions": {
                    "rest.action.multi.allow_explicit_index": "true",
                    "override_main_response_version": "true"
                },
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": "Production"
                    },
                    {
                        "Key": "Department",
                        "Value": "Analytics"
                    }
                ]
            }
        }
    }
}
```
</details>
<details><summary>Positive test num. 12 - yaml file</summary>

```yaml hl_lines="7"
AWSTemplateFormatVersion: '2010-09-09'
Description: Example

Resources:
  MyOpenSearchDomain:
    Type: AWS::OpenSearchService::Domain
    Properties:
      DomainName: my-sample-domain
      EngineVersion: Elasticsearch_7.10
      NodeToNodeEncryptionOptions:
      EncryptionAtRestOptions:
        Enabled: false
      DomainEndpointOptions:
        EnforceHTTPS: true
        TLSSecurityPolicy: Policy-Min-TLS-1-2-2019-07
      SnapshotOptions:
        AutomatedSnapshotStartHour: 3
      AdvancedOptions:
        rest.action.multi.allow_explicit_index: "true"
        override_main_response_version: "true"
      Tags:
        - Key: Environment
          Value: Production
        - Key: Project
          Value: OpenSearch

```
</details>


#### Code samples without security vulnerabilities
```yaml title="Negative test num. 1 - yaml file"
AWSTemplateFormatVersion: '2010-09-09'
Description: Example

Resources:
  MyOpenSearchDomain:
    Type: AWS::OpenSearchService::Domain
    Properties:
      DomainName: my-sample-domain
      EngineVersion: Elasticsearch_7.10
      ClusterConfig:
        InstanceType: r6g.large.search
        InstanceCount: 2
        DedicatedMasterEnabled: true
        DedicatedMasterType: r6g.large.search
        DedicatedMasterCount: 3
        ZoneAwarenessEnabled: true
        ZoneAwarenessConfig:
          AvailabilityZoneCount: 2
      EBSOptions:
        EBSEnabled: true
        VolumeType: gp3
        VolumeSize: 50
        Iops: 3000
        Throughput: 125
      AccessPolicies:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              AWS: "*"
            Action: "es:*"
            Resource: !Sub "arn:aws:es:${AWS::Region}:${AWS::AccountId}:domain/my-sample-domain/*"
      NodeToNodeEncryptionOptions:
        Enabled: true
      EncryptionAtRestOptions:
        Enabled: true
      DomainEndpointOptions:
        EnforceHTTPS: true
        TLSSecurityPolicy: Policy-Min-TLS-1-2-2019-07
      SnapshotOptions:
        AutomatedSnapshotStartHour: 3
      AdvancedOptions:
        rest.action.multi.allow_explicit_index: "true"
        override_main_response_version: "true"
      Tags:
        - Key: Environment
          Value: Production
        - Key: Project
          Value: OpenSearch

```
```json title="Negative test num. 2 - json file"
{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Example",
    "Resources": {
        "MyOpenSearchDomain": {
            "Type": "AWS::OpenSearchService::Domain",
            "Properties": {
                "DomainName": "my-sample-domain",
                "EngineVersion": "Elasticsearch_7.10",
                "ClusterConfig": {
                    "InstanceType": "r6g.large.search",
                    "InstanceCount": 2,
                    "DedicatedMasterEnabled": true,
                    "DedicatedMasterType": "r6g.large.search",
                    "DedicatedMasterCount": 3,
                    "ZoneAwarenessEnabled": true,
                    "ZoneAwarenessConfig": {
                        "AvailabilityZoneCount": 2
                    }
                },
                "EBSOptions": {
                    "EBSEnabled": true,
                    "VolumeType": "gp3",
                    "VolumeSize": 50,
                    "Iops": 3000,
                    "Throughput": 125
                },
                "AccessPolicies": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "AWS": "*"
                            },
                            "Action": "es:*",
                            "Resource": {
                                "Fn::Sub": "arn:aws:es:${AWS::Region}:${AWS::AccountId}:domain/my-sample-domain/*"
                            }
                        }
                    ]
                },
                "NodeToNodeEncryptionOptions": {
                    "Enabled": true
                },
                "EncryptionAtRestOptions": {
                    "Enabled": true
                },
                "DomainEndpointOptions": {
                    "EnforceHTTPS": true,
                    "TLSSecurityPolicy": "Policy-Min-TLS-1-2-2019-07"
                },
                "SnapshotOptions": {
                    "AutomatedSnapshotStartHour": 3
                },
                "AdvancedOptions": {
                    "rest.action.multi.allow_explicit_index": "true",
                    "override_main_response_version": "true"
                },
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": "Production"
                    },
                    {
                        "Key": "Project",
                        "Value": "OpenSearch"
                    }
                ]
            }
        }
    }
}
```
```yaml title="Negative test num. 3 - yaml file"
AWSTemplateFormatVersion: '2010-09-09'
Description: Example

Resources:
  MyElasticsearchDomain:
    Type: AWS::Elasticsearch::Domain
    Properties:
      DomainName: my-es-domain
      ElasticsearchVersion: 7.10
      ElasticsearchClusterConfig:
        InstanceType: r5.large.elasticsearch
        InstanceCount: 2
        DedicatedMasterEnabled: true
        DedicatedMasterType: r5.large.elasticsearch
        DedicatedMasterCount: 3
        ZoneAwarenessEnabled: true
        ZoneAwarenessConfig:
          AvailabilityZoneCount: 2
      EBSOptions:
        EBSEnabled: true
        VolumeType: gp2
        VolumeSize: 50
      AccessPolicies:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              AWS: "*"
            Action: "es:*"
            Resource: !Sub "arn:aws:es:${AWS::Region}:${AWS::AccountId}:domain/my-es-domain/*"
      NodeToNodeEncryptionOptions:
        Enabled: true
      EncryptionAtRestOptions:
        Enabled: true
      DomainEndpointOptions:
        EnforceHTTPS: true
        TLSSecurityPolicy: Policy-Min-TLS-1-2-2019-07
      SnapshotOptions:
        AutomatedSnapshotStartHour: 2
      AdvancedOptions:
        rest.action.multi.allow_explicit_index: "true"
        override_main_response_version: "true"
      Tags:
        - Key: Environment
          Value: Production
        - Key: Department
          Value: Analytics

```
<details><summary>Negative test num. 4 - json file</summary>

```json
{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Example",
    "Resources": {
        "MyElasticsearchDomain": {
            "Type": "AWS::Elasticsearch::Domain",
            "Properties": {
                "DomainName": "my-es-domain",
                "ElasticsearchVersion": 7.1,
                "ElasticsearchClusterConfig": {
                    "InstanceType": "r5.large.elasticsearch",
                    "InstanceCount": 2,
                    "DedicatedMasterEnabled": true,
                    "DedicatedMasterType": "r5.large.elasticsearch",
                    "DedicatedMasterCount": 3,
                    "ZoneAwarenessEnabled": true,
                    "ZoneAwarenessConfig": {
                        "AvailabilityZoneCount": 2
                    }
                },
                "EBSOptions": {
                    "EBSEnabled": true,
                    "VolumeType": "gp2",
                    "VolumeSize": 50
                },
                "AccessPolicies": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "AWS": "*"
                            },
                            "Action": "es:*",
                            "Resource": {
                                "Fn::Sub": "arn:aws:es:${AWS::Region}:${AWS::AccountId}:domain/my-es-domain/*"
                            }
                        }
                    ]
                },
                "NodeToNodeEncryptionOptions": {
                    "Enabled": true
                },
                "EncryptionAtRestOptions": {
                    "Enabled": true
                },
                "DomainEndpointOptions": {
                    "EnforceHTTPS": true,
                    "TLSSecurityPolicy": "Policy-Min-TLS-1-2-2019-07"
                },
                "SnapshotOptions": {
                    "AutomatedSnapshotStartHour": 2
                },
                "AdvancedOptions": {
                    "rest.action.multi.allow_explicit_index": "true",
                    "override_main_response_version": "true"
                },
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": "Production"
                    },
                    {
                        "Key": "Department",
                        "Value": "Analytics"
                    }
                ]
            }
        }
    }
}
```
</details>
<details><summary>Negative test num. 5 - yaml file</summary>

```yaml
AWSTemplateFormatVersion: '2010-09-09'
Description: Example

Resources:
  MyOpenSearchDomain:
    Type: AWS::OpenSearchService::Domain
    Properties:
      DomainName: my-sample-domain
      EngineVersion: Elasticsearch_7.10
      ClusterConfig:
        InstanceType: r6g.large.search
        InstanceCount: 2
        DedicatedMasterEnabled: true
        DedicatedMasterType: r6g.large.search
        DedicatedMasterCount: 3
        ZoneAwarenessEnabled: true
        ZoneAwarenessConfig:
          AvailabilityZoneCount: 2
      EBSOptions:
        EBSEnabled: true
        VolumeType: gp3
        VolumeSize: 50
        Iops: 3000
        Throughput: 125
      AccessPolicies:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              AWS: "*"
            Action: "es:*"
            Resource: !Sub "arn:aws:es:${AWS::Region}:${AWS::AccountId}:domain/my-sample-domain/*"
      NodeToNodeEncryptionOptions:
        Enabled: "true"
      EncryptionAtRestOptions:
        Enabled: true
      DomainEndpointOptions:
        EnforceHTTPS: true
        TLSSecurityPolicy: Policy-Min-TLS-1-2-2019-07
      SnapshotOptions:
        AutomatedSnapshotStartHour: 3
      AdvancedOptions:
        rest.action.multi.allow_explicit_index: "true"
        override_main_response_version: "true"
      Tags:
        - Key: Environment
          Value: Production
        - Key: Project
          Value: OpenSearch

```
</details>
<details><summary>Negative test num. 6 - json file</summary>

```json
{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Example",
    "Resources": {
        "MyOpenSearchDomain": {
            "Type": "AWS::OpenSearchService::Domain",
            "Properties": {
                "DomainName": "my-sample-domain",
                "EngineVersion": "Elasticsearch_7.10",
                "ClusterConfig": {
                    "InstanceType": "r6g.large.search",
                    "InstanceCount": 2,
                    "DedicatedMasterEnabled": true,
                    "DedicatedMasterType": "r6g.large.search",
                    "DedicatedMasterCount": 3,
                    "ZoneAwarenessEnabled": true,
                    "ZoneAwarenessConfig": {
                        "AvailabilityZoneCount": 2
                    }
                },
                "EBSOptions": {
                    "EBSEnabled": true,
                    "VolumeType": "gp3",
                    "VolumeSize": 50,
                    "Iops": 3000,
                    "Throughput": 125
                },
                "AccessPolicies": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "AWS": "*"
                            },
                            "Action": "es:*",
                            "Resource": {
                                "Fn::Sub": "arn:aws:es:${AWS::Region}:${AWS::AccountId}:domain/my-sample-domain/*"
                            }
                        }
                    ]
                },
                "NodeToNodeEncryptionOptions": {
                    "Enabled": "true"
                },
                "EncryptionAtRestOptions": {
                    "Enabled": true
                },
                "DomainEndpointOptions": {
                    "EnforceHTTPS": true,
                    "TLSSecurityPolicy": "Policy-Min-TLS-1-2-2019-07"
                },
                "SnapshotOptions": {
                    "AutomatedSnapshotStartHour": 3
                },
                "AdvancedOptions": {
                    "rest.action.multi.allow_explicit_index": "true",
                    "override_main_response_version": "true"
                },
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": "Production"
                    },
                    {
                        "Key": "Project",
                        "Value": "OpenSearch"
                    }
                ]
            }
        }
    }
}
```
</details>
<details><summary>Negative test num. 7 - yaml file</summary>

```yaml
AWSTemplateFormatVersion: '2010-09-09'
Description: Example

Resources:
  MyElasticsearchDomain:
    Type: AWS::Elasticsearch::Domain
    Properties:
      DomainName: my-es-domain
      ElasticsearchVersion: 7.10
      ElasticsearchClusterConfig:
        InstanceType: r5.large.elasticsearch
        InstanceCount: 2
        DedicatedMasterEnabled: true
        DedicatedMasterType: r5.large.elasticsearch
        DedicatedMasterCount: 3
        ZoneAwarenessEnabled: true
        ZoneAwarenessConfig:
          AvailabilityZoneCount: 2
      EBSOptions:
        EBSEnabled: true
        VolumeType: gp2
        VolumeSize: 50
      AccessPolicies:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              AWS: "*"
            Action: "es:*"
            Resource: !Sub "arn:aws:es:${AWS::Region}:${AWS::AccountId}:domain/my-es-domain/*"
      NodeToNodeEncryptionOptions:
        Enabled: "true"
      EncryptionAtRestOptions:
        Enabled: true
      DomainEndpointOptions:
        EnforceHTTPS: true
        TLSSecurityPolicy: Policy-Min-TLS-1-2-2019-07
      SnapshotOptions:
        AutomatedSnapshotStartHour: 2
      AdvancedOptions:
        rest.action.multi.allow_explicit_index: "true"
        override_main_response_version: "true"
      Tags:
        - Key: Environment
          Value: Production
        - Key: Department
          Value: Analytics

```
</details>
<details><summary>Negative test num. 8 - json file</summary>

```json
{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Example",
    "Resources": {
        "MyElasticsearchDomain": {
            "Type": "AWS::Elasticsearch::Domain",
            "Properties": {
                "DomainName": "my-es-domain",
                "ElasticsearchVersion": 7.1,
                "ElasticsearchClusterConfig": {
                    "InstanceType": "r5.large.elasticsearch",
                    "InstanceCount": 2,
                    "DedicatedMasterEnabled": true,
                    "DedicatedMasterType": "r5.large.elasticsearch",
                    "DedicatedMasterCount": 3,
                    "ZoneAwarenessEnabled": true,
                    "ZoneAwarenessConfig": {
                        "AvailabilityZoneCount": 2
                    }
                },
                "EBSOptions": {
                    "EBSEnabled": true,
                    "VolumeType": "gp2",
                    "VolumeSize": 50
                },
                "AccessPolicies": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "AWS": "*"
                            },
                            "Action": "es:*",
                            "Resource": {
                                "Fn::Sub": "arn:aws:es:${AWS::Region}:${AWS::AccountId}:domain/my-es-domain/*"
                            }
                        }
                    ]
                },
                "NodeToNodeEncryptionOptions": {
                    "Enabled": "true"
                },
                "EncryptionAtRestOptions": {
                    "Enabled": true
                },
                "DomainEndpointOptions": {
                    "EnforceHTTPS": true,
                    "TLSSecurityPolicy": "Policy-Min-TLS-1-2-2019-07"
                },
                "SnapshotOptions": {
                    "AutomatedSnapshotStartHour": 2
                },
                "AdvancedOptions": {
                    "rest.action.multi.allow_explicit_index": "true",
                    "override_main_response_version": "true"
                },
                "Tags": [
                    {
                        "Key": "Environment",
                        "Value": "Production"
                    },
                    {
                        "Key": "Department",
                        "Value": "Analytics"
                    }
                ]
            }
        }
    }
}
```
</details>
