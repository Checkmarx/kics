---
title: IAM policy allows for data exfiltration
hide:
  toc: true
  navigation: true
---

<style>
  .highlight .hll {
    background-color: #ff171742;
  }
  .md-content {
    max-width: 1100px;
    margin: 0 auto;
  }
</style>

-   **Query id:** 022f8938-4b17-420c-aca3-f917f290f322
-   **Query name:** IAM policy allows for data exfiltration
-   **Platform:** CloudFormation
-   **Severity:** <span style="color:#ff7213">Medium</span>
-   **Category:** Resource Management
-   **CWE:** <a href="https://cwe.mitre.org/data/definitions/200.html" onclick="newWindowOpenerSafe(event, 'https://cwe.mitre.org/data/definitions/200.html')">200</a>
-   **Risk score:** <span style="color:#ff7213">3.0</span>
-   **URL:** [Github](https://github.com/Checkmarx/kics/tree/master/assets/queries/cloudFormation/aws/iam_policy_allows_for_data_exfiltration)

### Description
This policy contains actions that can retrieve information unrestricted and could lead to data exfiltration<br>
[Documentation](https://cloudsplaining.readthedocs.io/en/latest/glossary/data-exfiltration/)

### Code samples
#### Code samples with security vulnerabilities
```yaml title="Positive test num. 1 - yaml file" hl_lines="14"
Resources:
  CFNUser:
    Type: AWS::IAM::User
    Properties:
      LoginProfile:
         Password: 'Password'
         PasswordResetRequired: false
      Policies:
        - PolicyName: root
          PolicyDocument:
            Version: "2012-10-17"
            Statement:
              - Effect: Allow
                Action:
                  - '*'
                Resource: '*'

```
```json title="Positive test num. 2 - json file" hl_lines="11"
{
  "Resources": {
    "CreateTestDBPolicy": {
      "Type": "AWS::IAM::ManagedPolicy",
      "Properties": {
        "PolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
        {
          "Effect": "Allow",
          "Action": [
                    "s3:GetObject", 
                    "ssm:GetParameter", 
                    "s3:*"
                  ],
          "Resource": "*"
        }
      ]
        },
        "Users": ["TestUser"],
        "Description": "Policy for creating a test database"
      }
    }
  }
}

```
```json title="Positive test num. 3 - json file" hl_lines="11"
{
  "Resources": {
    "CreateTestDBPolicy": {
      "Type": "AWS::IAM::ManagedPolicy",
      "Properties": {
        "PolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
        {
          "Effect": "Allow",
          "Action": "s3:*",
          "Resource": "*"
        }
      ]
        },
        "Users": ["TestUser"],
        "Description": "Policy for creating a test database"
      }
    }
  }
}

```
<details><summary>Positive test num. 4 - json file</summary>

```json hl_lines="13"
{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "MyPolicy": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyName": "CFNUsers",
        "PolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Effect": "Allow",
              "Action": "secretsmanager:GetSecretValue",
              "Resource": "*"
            }
          ]
        }
      }
    }
  }
}

```
</details>
<details><summary>Positive test num. 5 - yaml file</summary>

```yaml hl_lines="12"
AWSTemplateFormatVersion: "2010-09-09"
Resources:
  RootGroup:
    Type: 'AWS::IAM::Group'
    Properties:
      Policies:
        - PolicyName: root
          PolicyDocument:
            Version: "2012-10-17"
            Statement:
              - Effect: Allow
                Action:
                  - 'ssm:GetParameter'
                Resource: '*'
        - PolicyName: fullctrl
          PolicyDocument:
            Version: "2012-10-17"
            Statement:
              - Effect: Allow
                Action:
                  - 'iam:passrole'
                Resource: '*'

```
</details>
<details><summary>Positive test num. 6 - yaml file</summary>

```yaml hl_lines="11"
AWSTemplateFormatVersion: 2010-09-09
Resources:
  MyPolicy:
    Type: 'AWS::IAM::Policy'
    Properties:
      PolicyName: CFNUsers
      PolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Action:
              - 'ssm:GetParameters'
            Resource: '*'

```
</details>
<details><summary>Positive test num. 7 - yaml file</summary>

```yaml hl_lines="12"
AWSTemplateFormatVersion: "2010-09-09"
Resources:
  RootRole:
    Type: 'AWS::IAM::Role'
    Properties:
      Policies:
        - PolicyName: root
          PolicyDocument:
            Version: "2012-10-17"
            Statement:
              - Effect: Allow
                Action:
                  - 'ssm:GetParametersByPath'
                Resource: '*'
        - PolicyName: fullctrl
          PolicyDocument:
            Version: "2012-10-17"
            Statement:
              - Effect: Allow
                Action:
                  - 'iam:passrole'
                Resource: '*'

```
</details>
<details><summary>Positive test num. 8 - yaml file</summary>

```yaml hl_lines="9"
Resources:
  CreateTestDBPolicy:
    Type: AWS::IAM::ManagedPolicy
    Properties:
      PolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Action: "s3:*"
            Resource: "*"
      Users:
        - TestUser
      Description: "Policy for creating a test database"

```
</details>
<details><summary>Positive test num. 9 - json file</summary>

```json hl_lines="18"
{
  "Resources": {
    "CFNUser": {
      "Type": "AWS::IAM::User",
      "Properties": {
        "LoginProfile": {
          "Password": "Password",
          "PasswordResetRequired": false
        },
        "Policies": [
          {
            "PolicyName": "root",
            "PolicyDocument": {
              "Version": "2012-10-17",
              "Statement": [
                {
                  "Effect": "Allow",
                  "Action": [
                    "*"
                  ],
                  "Resource": "*"
                }
              ]
            }
          }
        ]
      }
    }
  }
}

```
</details>
<details><summary>Positive test num. 10 - json file</summary>

```json hl_lines="15"
{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "RootGroup": {
      "Type": "AWS::IAM::Group",
      "Properties": {
        "Policies": [
          {
            "PolicyName": "root",
            "PolicyDocument": {
              "Version": "2012-10-17",
              "Statement": [
                {
                  "Effect": "Allow",
                  "Action": [
                    "s3:GetObject"
                  ],
                  "Resource": "*"
                }
              ]
            }
          }
        ]
      }
    }
  }
}

```
</details>
<details><summary>Positive test num. 11 - json file</summary>

```json hl_lines="13"
{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "MyPolicy": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyName": "CFNUsers",
        "PolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Effect": "Allow",
              "Action": [
                "safe_action_1",
                "secretsmanager:GetSecretValue",
                "safe_action_2"
              ],
              "Resource": "*"
            }
          ]
        }
      }
    }
  }
}

```
</details>
<details><summary>Positive test num. 12 - json file</summary>

```json hl_lines="15"
{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "RootRole": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "Policies": [
          {
            "PolicyName": "root",
            "PolicyDocument": {
              "Version": "2012-10-17",
              "Statement": [
                {
                  "Effect": "Allow",
                  "Action": [
                    "s3:GetObject", 
                    "ssm:GetParameter", 
                    "s3:*"
                  ],
                  "Resource": "*"
                }
              ]
            }
          }
        ]
      }
    }
  }
}

```
</details>


#### Code samples without security vulnerabilities
```yaml title="Negative test num. 1 - yaml file"
Resources:
  CFNUser:
    Type: AWS::IAM::User
    Properties:
      LoginProfile:
         Password: 'Password'
         PasswordResetRequired: false
      Policies:
        - PolicyName: root
          PolicyDocument:
            Version: "2012-10-17"
            Statement:
              - Effect: Allow
                Action:
                  - 'safe_action'
                Resource: '*'

```
```json title="Negative test num. 2 - json file"
{
  "Resources": {
    "CreateTestDBPolicy": {
      "Type": "AWS::IAM::ManagedPolicy",
      "Properties": {
        "PolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
        {
          "Effect": "Allow",
          "Action": "safe_action",
          "Resource": "*"
        }
      ]
        },
        "Users": ["TestUser"],
        "Description": "Policy for creating a test database"
      }
    }
  }
}

```
```yaml title="Negative test num. 3 - yaml file"
AWSTemplateFormatVersion: "2010-09-09"
Resources:
  RootGroup:
    Type: 'AWS::IAM::Group'
    Properties:
      Policies:
        - PolicyName: root
          PolicyDocument:
            Version: "2012-10-17"
            Statement:
              - Effect: Allow
                Action:
                  - 'safe_action'
                Resource: '*'
        - PolicyName: fullctrl
          PolicyDocument:
            Version: "2012-10-17"
            Statement:
              - Effect: Allow
                Action:
                  - 'iam:passrole'
                Resource: '*'

```
<details><summary>Negative test num. 4 - yaml file</summary>

```yaml
AWSTemplateFormatVersion: 2010-09-09
Resources:
  MyPolicy:
    Type: 'AWS::IAM::Policy'
    Properties:
      PolicyName: CFNUsers
      PolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Action:
              - 'safe_action'
            Resource: '*'

```
</details>
<details><summary>Negative test num. 5 - yaml file</summary>

```yaml
AWSTemplateFormatVersion: "2010-09-09"
Resources:
  RootRole:
    Type: 'AWS::IAM::Role'
    Properties:
      Policies:
        - PolicyName: root
          PolicyDocument:
            Version: "2012-10-17"
            Statement:
              - Effect: Allow
                Action:
                  - 'safe_action'
                Resource: '*'
        - PolicyName: fullctrl
          PolicyDocument:
            Version: "2012-10-17"
            Statement:
              - Effect: Allow
                Action:
                  - 'iam:passrole'
                Resource: '*'

```
</details>
<details><summary>Negative test num. 6 - yaml file</summary>

```yaml
Resources:
  CreateTestDBPolicy:
    Type: AWS::IAM::ManagedPolicy
    Properties:
      PolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Action: "safe_action"
            Resource: "*"
      Users:
        - TestUser
      Description: "Policy for creating a test database"

```
</details>
<details><summary>Negative test num. 7 - json file</summary>

```json
{
  "Resources": {
    "CFNUser": {
      "Type": "AWS::IAM::User",
      "Properties": {
        "LoginProfile": {
          "Password": "Password",
          "PasswordResetRequired": false
        },
        "Policies": [
          {
            "PolicyName": "root",
            "PolicyDocument": {
              "Version": "2012-10-17",
              "Statement": [
                {
                  "Effect": "Allow",
                  "Action": [
                    "safe_action"
                  ],
                  "Resource": "*"
                }
              ]
            }
          }
        ]
      }
    }
  }
}

```
</details>
<details><summary>Negative test num. 8 - json file</summary>

```json
{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "RootGroup": {
      "Type": "AWS::IAM::Group",
      "Properties": {
        "Policies": [
          {
            "PolicyName": "root",
            "PolicyDocument": {
              "Version": "2012-10-17",
              "Statement": [
                {
                  "Effect": "Allow",
                  "Action": [
                    "safe_action"
                  ],
                  "Resource": "*"
                }
              ]
            }
          }
        ]
      }
    }
  }
}

```
</details>
<details><summary>Negative test num. 9 - json file</summary>

```json
{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "MyPolicy": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyName": "CFNUsers",
        "PolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Effect": "Allow",
              "Action": [
                "safe_action"
              ],
              "Resource": "*"
            }
          ]
        }
      }
    }
  }
}

```
</details>
<details><summary>Negative test num. 10 - json file</summary>

```json
{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "RootRole": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "Policies": [
          {
            "PolicyName": "root",
            "PolicyDocument": {
              "Version": "2012-10-17",
              "Statement": [
                {
                  "Effect": "Allow",
                  "Action": [
                    "safe_action"
                  ],
                  "Resource": "*"
                }
              ]
            }
          }
        ]
      }
    }
  }
}

```
</details>

