---
title: Block Device Is Not Encrypted
hide:
  toc: true
  navigation: true
---

<style>
  .highlight .hll {
    background-color: #ff171742;
  }
  .md-content {
    max-width: 1100px;
    margin: 0 auto;
  }
</style>

-   **Query id:** 1f624961-9a18-4387-91c8-3856e1974b6f
-   **Query name:** Block Device Is Not Encrypted
-   **Platform:** Terraform
-   **Severity:** <span style="color:#bb2124">High</span>
-   **Category:** Encryption
-   **CWE:** <a href="https://cwe.mitre.org/data/definitions/311.html" onclick="newWindowOpenerSafe(event, 'https://cwe.mitre.org/data/definitions/311.html')">311</a>
-   **Risk score:** <span style="color:#bb2124">6.0</span>
-   **URL:** [Github](https://github.com/Checkmarx/kics/tree/master/assets/queries/terraform/aws/block_device_is_not_encrypted)

### Description
Block device mappings for Launch Configurations and EC2 instances should mandate encryption of all attached EBS volumes to safeguard sensitive data. This is achieved by specifying the 'encrypted' parameter with a value of 'true' for each volume.<br>
[Documentation](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/launch_configuration#encrypted)

### Code samples
#### Code samples with security vulnerabilities
```tf title="Positive test num. 1 - tf file" hl_lines="11 28 36"
resource "aws_launch_configuration" "example1" {
  image_id      = data.aws_ami.ubuntu.id
  instance_type = "m4.large"
  spot_price    = "0.001"
  user_data_base64 = "c29tZUtleQ==" # someKey

  lifecycle {
    create_before_destroy = true
  }

  ebs_block_device {
    device_name = "/dev/xvda1"
  }
}

resource "aws_launch_configuration" "example2" {
  image_id      = data.aws_ami.ubuntu.id
  instance_type = "m4.large"
  spot_price    = "0.001"
  user_data_base64 = "c29tZUtleQ==" # someKey

  lifecycle {
    create_before_destroy = true
  }

  ebs_block_device {
    device_name = "/dev/xvda1"
    encrypted = false
  }
}

resource "aws_launch_configuration" "example3" {
  name = "test-launch-config"

  root_block_device {
    encrypted = false
  }
}

```
```tf title="Positive test num. 2 - tf file" hl_lines="16 35 28 7"
module "asg" {
  source = "terraform-aws-modules/autoscaling/aws"
  version = "1.0.4"

  ebs_block_device = [
     {
      device_name           = "/dev/xvdz"
      volume_type           = "gp2"
      volume_size           = "50"
      delete_on_termination = true
    }
  ]

  root_block_device = [
     {
      volume_size = "50"
      volume_type = "gp2"
     }
  ]
}

module "asg2" {
  source  = "terraform-aws-modules/autoscaling/aws"
  version = "6.0"

  block_device_mappings = [
    { 
      ebs = {  # Root device
        volume_size           = 50
        volume_type           = "gp2"
      }
    },
    {
      device_name = "/dev/xvdz" # EBS device
      ebs = {
        volume_size           = 50
        volume_type           = "gp2"
        delete_on_termination = true
      }
    }
  ]
}
```
```tf title="Positive test num. 3 - tf file" hl_lines="27 17 11 29"
module "asg" {
  source = "terraform-aws-modules/autoscaling/aws"
  version = "1.0.4"

  ebs_block_device = [ 
    {
      device_name           = "/dev/xvdz"
      volume_type           = "gp2"
      volume_size           = "50"
      delete_on_termination = true
      encrypted             = false
    }
  ]

  root_block_device = [ 
    {
      volume_size = "50"
      volume_type = "gp2"
    }
  ]
}

module "asg2" {
  source  = "terraform-aws-modules/autoscaling/aws"
  version = "6.0"

  block_device_mappings = [
    { 
      ebs = { # Root volume
        volume_size           = 50
        volume_type           = "gp2"
        delete_on_termination = true
      }
    },
    {
      device_name = "/dev/xvdz" # Additional EBS volume
      ebs = {
        volume_size           = 50
        volume_type           = "gp2"
        delete_on_termination = true
        encrypted             = false
      }
    }
  ]
}

```
<details><summary>Positive test num. 4 - tf file</summary>

```tf hl_lines="41 18 27 7"
module "asg" {
  source = "terraform-aws-modules/autoscaling/aws"
  version = "1.0.4"

  ebs_block_device = [
     {
      device_name           = "/dev/xvdz"
      volume_type           = "gp2"
      volume_size           = "50"
      delete_on_termination = true
     }
  ]

  root_block_device = [
    {
      volume_size = "50"
      volume_type = "gp2"
      encrypted   = false
    }
  ]
}

module "asg2" {
  source  = "terraform-aws-modules/autoscaling/aws"
  version = "6.0"

  block_device_mappings = [
    { 
      ebs = { # Root volume
        volume_size  = 50
        volume_type  = "gp2"
        encrypted    = false
      }
    },
    {
      device_name = "/dev/xvdz" # Additional EBS volume
      ebs = {
        volume_size           = 50
        volume_type           = "gp2"
        delete_on_termination = true
        encrypted             = false
      }
    }
  ]
}
```
</details>
<details><summary>Positive test num. 5 - tf file</summary>

```tf hl_lines="31 7"
resource "aws_instance" "example1" {
  ami                         = "ami-074251216af698218"
  instance_type      = "t2.micro"

  root_block_device {
    delete_on_termination = true
    encrypted             = false
    throughput            = "0"
    volume_size           = "8"
    volume_type           = "gp2"
  }

  tags = {
    Name = "web-app-instance"
  }
}

resource "aws_instance" "example2" {
  ami           = "ami-0c55b159cbfafe1f0" 
  instance_type = "t3.micro"

  tags = {
    Name = "positive5"
  }

  ebs_block_device {
    device_name           = "/dev/sdh"
    volume_size           = 10         
    volume_type           = "gp3"
    delete_on_termination = true
    encrypted             = false
  }
}

```
</details>
<details><summary>Positive test num. 6 - tf file</summary>

```tf hl_lines="24 5"
resource "aws_instance" "example1" {
  ami                         = "ami-074251216af698218"
  instance_type      = "t2.micro"

  root_block_device {
    throughput            = "0"
    volume_size           = "8"
    volume_type           = "gp2"
  }

  tags = {
    Name = "web-app-instance"
  }
}

resource "aws_instance" "example2" {
  ami           = "ami-0c55b159cbfafe1f0" 
  instance_type = "t3.micro"

  tags = {
    Name = "web-app-instance"
  }

  ebs_block_device {
    device_name           = "/dev/sdh" 
    volume_size           = 10         
    volume_type           = "gp3"
  }
}

```
</details>
<details><summary>Positive test num. 7 - tf file</summary>

```tf hl_lines="11 29"
module "positive7-aws6" {
  source  = "terraform-aws-modules/ec2-instance/aws"
  version = "~> 6.0"

  name           = "web-app-instance"
  ami            = "ami-074251216af698218"
  instance_type  = "t2.micro"

  root_block_device = {
    delete_on_termination = true
    encrypted             = false
    throughput            = 0
    volume_size           = 8
    volume_type           = "gp2"
  }
}

module "positive7-legacy" {
  source  = "terraform-aws-modules/ec2-instance/aws"
  version = "~> 5.7"

  name           = "web-app-instance"
  ami            = "ami-074251216af698218"
  instance_type  = "t2.micro"

  root_block_device = [
    {
    delete_on_termination = true
    encrypted             = false
    throughput            = 0
    volume_size           = 8
    volume_type           = "gp2"
   }
  ]
}


```
</details>
<details><summary>Positive test num. 8 - tf file</summary>

```tf hl_lines="10 27"
module "positive8-aws6" {
  source  = "terraform-aws-modules/ec2-instance/aws"
  version = "~> 6.0"

  name           = "web-app-instance"
  ami            = "ami-074251216af698218"
  instance_type  = "t2.micro"

  root_block_device = {
    encrypted             = false
    throughput            = 0
    volume_size           = 8
    volume_type           = "gp3"
  }
}

module "positive8-legacy" {
  source  = "terraform-aws-modules/ec2-instance/aws"
  version = "~> 5.7"

  name           = "web-app-instance"
  ami            = "ami-074251216af698218"
  instance_type  = "t2.micro"

  root_block_device = [
    {
    encrypted             = false
    throughput            = 0
    volume_size           = 8
    volume_type           = "gp3"
  }
  ]
}

```
</details>
<details><summary>Positive test num. 9 - tf file</summary>

```tf hl_lines="9 26"
module "positive9-aws6" {
  source  = "terraform-aws-modules/ec2-instance/aws"
  version = "~> 6.0"

  name           = "web-app-instance"
  ami            = "ami-074251216af698218"
  instance_type  = "t2.micro"

  root_block_device = {
    throughput            = 0
    volume_size           = 8
    volume_type           = "gp2"
  }
}

module "positive9-legacy" {
  source  = "terraform-aws-modules/ec2-instance/aws"
  version = "~> 5.7"

  name           = "web-app-instance"
  ami            = "ami-074251216af698218"
  instance_type  = "t2.micro"

  root_block_device = [
    {
    throughput            = 0
    volume_size           = 8
    volume_type           = "gp2"
   }
  ]
}
```
</details>


#### Code samples without security vulnerabilities
```tf title="Negative test num. 1 - tf file"
resource "aws_launch_configuration" "negative1-1" {
  image_id      = data.aws_ami.ubuntu.id
  instance_type = "m4.large"
  spot_price    = "0.001"
  user_data_base64 = "c29tZUtleQ==" # someKey

  lifecycle {
    create_before_destroy = true
  }

  ebs_block_device {
    device_name = "/dev/xvda1"
    encrypted = true
  }
}

resource "aws_launch_configuration" "negative1-2" {
  name = "test-launch-config"

  ephemeral_block_device {
    encrypted = false
  }
}

```
```tf title="Negative test num. 2 - tf file"
module "negative2" {
  source  = "terraform-aws-modules/autoscaling/aws"
  version = "6.0"

  block_device_mappings = [
    {
      device_name = "/dev/xvda" # Root volume
      ebs = {
        volume_size           = 50
        volume_type           = "gp2"
        delete_on_termination = true
        encrypted             = true
      }
    },
    {
      device_name = "/dev/xvdz" # Additional EBS volume
      ebs = {
        volume_size           = 50
        volume_type           = "gp2"
        delete_on_termination = true
        encrypted             = true
      }
    }
  ]
}

module "negative2-legacy" {
  source = "terraform-aws-modules/autoscaling/aws"
  version = "1.0.4"

  ebs_block_device = [
    {
      device_name           = "/dev/xvdz"
      volume_type           = "gp2"
      volume_size           = "50"
      delete_on_termination = true
      encrypted             = true
    }
 ]

  root_block_device = [ 
    {
      volume_size = "50"
      volume_type = "gp2"
      encrypted   = true
    }
  ]
}

```
```tf title="Negative test num. 3 - tf file"
resource "aws_instance" "negative3-1" {
  ami                         = "ami-074251216af698218"
  instance_type      = "t2.micro"

  root_block_device {
    delete_on_termination = true
    encrypted             = true
    throughput            = "0"
    volume_size           = "8"
    volume_type           = "gp2"
  }
}


resource "aws_instance" "negative3-2" {
  ami           = "ami-0c55b159cbfafe1f0" 
  instance_type = "t3.micro"

  ebs_block_device {
    device_name           = "/dev/sdh"
    volume_size           = 10         
    volume_type           = "gp3"
    delete_on_termination = true
    encrypted             = true
  }
}

```
<details><summary>Negative test num. 4 - tf file</summary>

```tf
module "negative4" {
  source  = "terraform-aws-modules/ec2-instance/aws"
  version = "~> 6.0"

  root_block_device = {
    delete_on_termination = true
    encrypted             = true
    throughput            = 0
    volume_size           = 8
    volume_type           = "gp2"
  }

  ebs_block_device {
    device_name           = "/dev/sdh"
    volume_size           = 10         
    volume_type           = "gp3"
    delete_on_termination = true
    encrypted             = true
  }
}

module "negative4-legacy" {
  source  = "terraform-aws-modules/ec2-instance/aws"
  version = "~> 5.0"

  root_block_device = [
    {
      delete_on_termination = true
      encrypted             = true
      volume_size           = 8
      volume_type           = "gp2"
    }
  ]

  ebs_block_device = [
    {
      device_name           = "/dev/sdh"
      volume_size           = 10
      volume_type           = "gp3"
      delete_on_termination = true
      encrypted             = true
    }
  ]
}

```
</details>

