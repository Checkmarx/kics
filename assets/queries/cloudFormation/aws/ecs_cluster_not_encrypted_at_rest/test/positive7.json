{
  "Resources": {
    "ECSLaunchTemplate": {
      "Type": "AWS::EC2::LaunchTemplate",
      "Properties": {
        "LaunchTemplateName": "ECS-Encrypted-LT",
        "LaunchTemplateData": {
          "ImageId": "ami-xxxxxxxxxxxxxx",
          "InstanceType": "t3.micro",
          "BlockDeviceMappings": [
            {
              "DeviceName": "/dev/xvda"
            }
          ],
          "UserData": {
            "Fn::Base64": {
              "Fn::Sub": "#!/bin/bash\necho ECS_CLUSTER=${ECSCluster} >> /etc/ecs/ecs.config"
            }
          }
        }
      }
    },
    "ECSAutoScalingGroup": {
      "Type": "AWS::AutoScaling::AutoScalingGroup",
      "Properties": {
        "LaunchTemplate": {
          "LaunchTemplateId": {
            "Ref": "ECSLaunchTemplate"
          },
          "Version": {
            "Fn::GetAtt": ["ECSLaunchTemplate", "LatestVersionNumber"]
          }
        },
        "MinSize": "1",
        "MaxSize": "3",
        "DesiredCapacity": "2",
        "VPCZoneIdentifier": [
          "subnet-xxxxxxxxxxxxxx"
        ]
      }
    },
    "ECSCluster": {
      "Type": "AWS::ECS::Cluster",
      "Properties": {
        "ClusterName": "MyEncryptedCluster"
      }
    }
  }
}
