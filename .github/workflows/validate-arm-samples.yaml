name: validate-arm-samples

on:
  pull_request:
    paths:
      - "assets/queries/azureResourceManager/**/test/*.json"

jobs:
  lint-json-samples:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2.3.4
        with:
          persist-credentials: false
      - name: Get commit changed files
        uses: lots0logs/gh-action-get-changed-files@2.1.4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: Running JSON lint
        run: |
          wget https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json -O arm-schema.json
          ls -la
      - name: Read CHANGED files
        id: read_json_files
        run: |
          echo "::set-output name=cfiles::$(cat ${HOME}/files.json | grep .json | tr '\n' ' ')"
      - name: debug
        run: |
          echo ${{ read_json_files.outputs.cfiles }}
      - name: Validate JSON
        uses: docker://orrosenblatt/validate-json-action:latest
        env:
          INPUT_SCHEMA: arm-schema.json
          INPUT_JSONS: ${{ read_json_files.outputs.cfiles }}
